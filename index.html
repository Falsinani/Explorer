<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Web File Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      margin: 0;
      background: #111;
      color: #fff;
      font-family: system-ui, sans-serif;
      direction: rtl;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 15px;
      background: #222;
      font-size: 20px;
      font-weight: 600;
      text-align: center;
    }

    #picker {
      padding: 15px;
      background: #181818;
      text-align: center;
    }

    input[type="file"] {
      padding: 10px;
      background: #00c853;
      color: #fff;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }

    #fileList {
      flex: 1;
      overflow-y: auto;
      border-top: 1px solid #333;
    }

    .item {
      padding: 10px;
      border-bottom: 1px solid #333;
      cursor: pointer;
    }

    .item:hover {
      background: #252525;
    }

    /* ==========================
       Viewer Window + Zoom
       ========================== */

    #viewer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.92);
      display: none;
      flex-direction: column;
      z-index: 10;
    }

    #viewerContent {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      padding: 10px;
    }

    #closeBtn {
      background: #d50000;
      color: #fff;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      margin: 15px auto;
      display: block;
      font-size: 16px;
    }

    /* Ø¹Ù†ØµØ± ÙŠØ¯Ø¹Ù… Ø§Ù„ØªÙƒØ¨ÙŠØ± */
    .zoomable {
      touch-action: none;
      transform-origin: center center;
      transition: transform 0.15s ease-out;
    }
  </style>
</head>

<body>

<header>ğŸ“„ Web File Viewer</header>

<div id="picker">
  <input type="file" id="fileInput" multiple>
</div>

<div id="fileList"></div>

<!-- ==========================
     Viewer Window
     ========================== -->
<div id="viewer">
  <button id="closeBtn">Ø¥ØºÙ„Ø§Ù‚</button>
  <div id="viewerContent"></div>
</div>

<script>
/* ================================
   Ø¹Ù†Ø§ØµØ± DOM
================================ */

const fileInput = document.getElementById("fileInput");
const fileList = document.getElementById("fileList");
const viewer = document.getElementById("viewer");
const viewerContent = document.getElementById("viewerContent");
const closeBtn = document.getElementById("closeBtn");

let selectedFiles = [];

/* ================================
   Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
================================ */

fileInput.addEventListener("change", (e) => {
  selectedFiles = Array.from(e.target.files);
  fileList.innerHTML = "";

  selectedFiles.forEach((file, index) => {
    const div = document.createElement("div");
    div.className = "item";
    div.textContent = `${file.name} - ${Math.round(file.size/1024)} KB`;
    div.onclick = () => viewFile(file);
    fileList.appendChild(div);
  });
});

/* ================================
   Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©: Ø¹Ø±Ø¶ Ù…Ù„Ù
================================ */

function viewFile(file) {
  viewer.style.display = "flex";
  viewerContent.innerHTML = "";

  const type = file.type;

  let el;

  // ===== Ø§Ù„ØµÙˆØ± =====
  if (type.startsWith("image/")) {
    el = document.createElement("img");
    el.src = URL.createObjectURL(file);
    el.style.maxWidth = "100%";
    el.style.maxHeight = "100%";
  }

  // ===== PDF =====
  else if (type === "application/pdf") {
    el = document.createElement("iframe");
    el.src = URL.createObjectURL(file);
    el.style.width = "100%";
    el.style.height = "100%";
  }

  // ===== ÙÙŠØ¯ÙŠÙˆ =====
  else if (type.startsWith("video/")) {
    el = document.createElement("video");
    el.src = URL.createObjectURL(file);
    el.controls = true;
    el.style.maxWidth = "100%";
  }

  // ===== ØµÙˆØª =====
  else if (type.startsWith("audio/")) {
    el = document.createElement("audio");
    el.src = URL.createObjectURL(file);
    el.controls = true;
    el.style.width = "100%";
  }

  // ===== Ù†ØµÙˆØµ =====
  else if (
    type.startsWith("text/") ||
    file.name.endsWith(".json") ||
    file.name.endsWith(".html") ||
    file.name.endsWith(".js")
  ) {
    el = document.createElement("pre");
    const reader = new FileReader();
    reader.onload = () => (el.textContent = reader.result);
    reader.readAsText(file);
    el.style.whiteSpace = "pre-wrap";
    el.style.fontSize = "14px";
  }

  // ===== ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… â†’ ØªØ­Ù…ÙŠÙ„ =====
  else {
    el = document.createElement("div");
    el.innerHTML = `
      <p>Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¹Ø±Ø¶ Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ù…Ù„ÙØ§Øª.</p>
      <a href="${URL.createObjectURL(file)}" download="${file.name}" style="color:#4fc3f7;">
        ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
      </a>
    `;
  }

  viewerContent.appendChild(el);
  enablePinchZoom(el);
}

/* ================================
   Pinch-to-Zoom + Pan
================================ */

let scale = 1;
let lastScale = 1;
let pinchStartDist = 0;

let startX = 0;
let startY = 0;
let lastX = 0;
let lastY = 0;

function enablePinchZoom(el) {
  el.classList.add("zoomable");

  el.addEventListener("touchstart", (e) => {
    if (e.touches.length === 2) {
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø¥ØµØ¨Ø¹ÙŠÙ†
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      pinchStartDist = Math.sqrt(dx * dx + dy * dy);
      lastScale = scale;
    } else if (e.touches.length === 1 && scale > 1) {
      startX = e.touches[0].clientX - lastX;
      startY = e.touches[0].clientY - lastY;
    }
  });

  el.addEventListener("touchmove", (e) => {
    // ØªÙƒØ¨ÙŠØ±
    if (e.touches.length === 2) {
      const dx = e.touches[0].clientX - e.touches[1].clientX;
      const dy = e.touches[0].clientY - e.touches[1].clientY;
      const newDist = Math.sqrt(dx * dx + dy * dy);

      scale = Math.min(4, Math.max(1, lastScale * (newDist / pinchStartDist)));
      el.style.transform = `scale(${scale}) translate(${lastX}px, ${lastY}px)`;
    }

    // Ø³Ø­Ø¨ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙƒØ¨ÙŠØ±
    else if (e.touches.length === 1 && scale > 1) {
      lastX = (e.touches[0].clientX - startX) / scale;
      lastY = (e.touches[0].clientY - startY) / scale;
      el.style.transform = `scale(${scale}) translate(${lastX}px, ${lastY}px)`;
    }
  });

  // Ù†Ù‚Ø± Ù…Ø²Ø¯ÙˆØ¬ â†’ Ø¥Ø¹Ø§Ø¯Ø© Ù„Ù„Ø­Ø¬Ù… Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
  el.addEventListener("dblclick", () => {
    scale = 1;
    lastX = 0;
    lastY = 0;
    el.style.transform = "scale(1) translate(0, 0)";
  });
}

/* ================================
   Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¹Ø§Ø±Ø¶
================================ */

closeBtn.onclick = () => {
  viewer.style.display = "none";
  viewerContent.innerHTML = "";
  scale = 1;
  lastX = 0;
  lastY = 0;
};
</script>

</body>
</html>
